<script setup>
    import ElementListLayout from "../../layout/ElementListLayout.vue";
    import CustomTable from "../../components/customTable.vue";
    import bannerImage from "../../assets/img/CPUBanner.jpg";
    import { ref, onMounted } from "vue";
    import { getAllCpu, addCpu, updateCpu, deleteCpu } from "../../service/SPCTService.js";
    import Modal from "../../components/Modal.vue";
    
    const headers = [
      "STT", "Hãng CPU", "Tên CPU", "Thế hệ CPU", "Số nhân", "Số lượng", "Xung nhịp", "Thao tác"
    ];
    
    const cpuList = ref([]);
    const isModalOpen = ref(false);
    const isEditing = ref(false);
    const selectedCpu = ref(null);
    
    const fetchCpuList = async () => {
      const data = await fetchCpus();
      cpuList.value = data.map((cpu, i) => ({
        stt: i + 1,
        hangCpu: cpu.hangCpu,
        tenCpu: cpu.tenCpu,
        theHeCpu: cpu.theHeCpu,
        soNhan: cpu.soNhan,
        soLuong: cpu.soLuong,
        xungNhip: cpu.xungNhip,
        actions: `<button class='text-blue-500' @click="editCpu(${cpu.id})">Sửa</button> |
                  <button class='text-red-500' @click="softDeleteCpu(${cpu.id})">Xóa</button>`,
        id: cpu.id,
      }));
    };
    
    const openModal = (cpu = null) => {
      isEditing.value = !!cpu;
      selectedCpu.value = cpu || { maCpu: "", hangCpu: "", tenCpu: "", theHeCpu: "", soNhan: 0, soLuong: 0, xungNhip: 0.0 };
      isModalOpen.value = true;
    };
    
    const closeModal = () => {
      isModalOpen.value = false;
    };
    
    const saveCpu = async () => {
      if (isEditing.value) {
        await updateCpu(selectedCpu.value.id, selectedCpu.value);
      } else {
        await addCpu(selectedCpu.value);
      }
      fetchCpuList();
      closeModal();
    };
    
    const softDeleteCpu = async (id) => {
      await deleteCpu(id);
      fetchCpuList();
    };
    
    onMounted(fetchCpuList);
    </script>
    <template>
      <ElementListLayout title="DANH SÁCH CPU">
        <CustomTable :headers="headers" :data="cpuList" @row-click="editCpu" />
      </ElementListLayout>
    
      <Modal :isOpen="isModalOpen" @close="closeModal">
        <form @submit.prevent="saveCpu">
          <input v-model="selectedCpu.maCpu" placeholder="Mã CPU" class="border p-2 w-full mb-2" required />
          <input v-model="selectedCpu.hangCpu" placeholder="Hãng CPU" class="border p-2 w-full mb-2" required />
          <input v-model="selectedCpu.tenCpu" placeholder="Tên CPU" class="border p-2 w-full mb-2" required />
          <input v-model="selectedCpu.theHeCpu" placeholder="Thế hệ CPU" class="border p-2 w-full mb-2" required />
          <input type="number" v-model="selectedCpu.soNhan" placeholder="Số nhân" class="border p-2 w-full mb-2" required />
          <input type="number" v-model="selectedCpu.soLuong" placeholder="Số lượng" class="border p-2 w-full mb-2" required />
          <input type="number" step="0.1" v-model="selectedCpu.xungNhip" placeholder="Xung nhịp (GHz)" class="border p-2 w-full mb-2" required />
    
          <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg w-full">
            {{ isEditing ? "Cập nhật" : "Thêm mới" }}
          </button>
        </form>
      </Modal>
    </template>
    